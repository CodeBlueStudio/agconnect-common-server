"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},error_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.CredentialParser=void 0,require("../error/error")),error_message_1=require("../error/error-message"),credential_type_1=require("./credential-type"),clientid_credential_1=require("./clientid-credential"),utils_1=require("../utils/utils"),fs_1=__importDefault(require("fs")),CredentialParser=function(){function i(){}return i.toCredential=function(e,r){var t;if(e)i.checkJsonFile(e),t=fs_1.default.readFileSync(e,"utf8");else{e=process.env[i.AGC_CONFIG_ENV_VAR];if(null==e)throw new error_1.AGCError(error_message_1.ErrorCodeConstant.CREDENTIAL_ENV_NOT_SET);i.checkJsonFile(e),t=fs_1.default.readFileSync(e,"utf8")}return this.toCredentialWithContents(t,r)},i.toCredentialWithContents=function(e,r){var t=JSON.parse(e);if(null==t)throw new error_1.AGCError(error_message_1.ErrorCodeConstant.CREDENTIAL_PARSER);switch(t.type){case credential_type_1.CredentialType.TEAM_CLIENT_ID:var i=r?r():t.client_secret;return new clientid_credential_1.ClientIdCredential("","",t.developer_id,t.type,t.client_id,i,t.configuration_version);case credential_type_1.CredentialType.PROJECT_CLIENT_ID:return i=r?r():t.client_secret,new clientid_credential_1.ClientIdCredential(t.project_id,t.region,t.developer_id,t.type,t.client_id,i,t.configuration_version);default:throw new error_1.AGCError(error_message_1.ErrorCodeConstant.CREDENTIAL_PARSER)}},i.checkJsonFile=function(e){try{(0,utils_1.voilidatePath)(e)}catch(e){throw e instanceof error_1.AGCError?new error_1.AGCError(error_message_1.ErrorCodeConstant.AGC_CLIENT_CREDENTIAL,void 0,void 0,e.getMessage()):new error_1.AGCError(error_message_1.ErrorCodeConstant.AGC_CLIENT_CREDENTIAL)}},i.AGC_CONFIG_ENV_VAR="AGC_CONFIG",i}();exports.CredentialParser=CredentialParser;